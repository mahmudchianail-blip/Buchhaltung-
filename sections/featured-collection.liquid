{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}
{{ 'template-collection.css' | asset_url | stylesheet_tag }}

{% if section.settings.image_shape == 'blob' %}
  {{ 'mask-blobs.css' | asset_url | stylesheet_tag }}
{%- endif -%}

{%- unless section.settings.quick_add == 'none' -%}
  {{ 'quick-add.css' | asset_url | stylesheet_tag }}
  <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
{%- endunless -%}

{%- if section.settings.quick_add == 'standard' -%}
  <script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{%- if section.settings.quick_add == 'bulk' -%}
  <script src="{{ 'quick-add-bulk.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'quantity-popover.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'price-per-item.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'quick-order-list.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{%- style -%}
  /* ---------- Modern Design Tokens (scoped to this section) ---------- */
  .section-{{ section.id }}-wrap {
    --modern-bg: radial-gradient(1200px 600px at 0% 0%, rgb(16 185 129 / 0.06), transparent 50%),
                 radial-gradient(1000px 500px at 100% 0%, rgb(59 130 246 / 0.05), transparent 50%),
                 var(--color-gradient-background, transparent);
    --card-bg: color-mix(in oklab, var(--color-card-background, #ffffff) 78%, transparent);
    --card-border: color-mix(in oklab, var(--color-foreground, #000) 12%, transparent);
    --card-shadow: 0 8px 24px rgb(0 0 0 / 0.08), 0 2px 8px rgb(0 0 0 / 0.06);
    --card-radius: 18px;
    --elev: 0 16px 36px rgb(0 0 0 / 0.10), 0 6px 16px rgb(0 0 0 / 0.08);
    --ring: 0 0 0 1px color-mix(in oklab, var(--color-foreground, #000) 14%, transparent);
    --ring-strong: 0 0 0 2px color-mix(in oklab, var(--color-foreground, #000) 22%, transparent);
    --gap: clamp(12px, 2.5vw, 20px);
    --title-weight: 750;
    background: var(--modern-bg);
  }

  @media (prefers-color-scheme: dark) {
    .section-{{ section.id }}-wrap {
      --card-bg: color-mix(in oklab, #0b0f14 75%, transparent);
      --card-border: color-mix(in oklab, #cbd5e1 12%, transparent);
      --card-shadow: 0 8px 24px rgb(0 0 0 / 0.35), 0 2px 8px rgb(0 0 0 / 0.25);
    }
  }

  /* ---------- Section Spacing ---------- */
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* ---------- Header ---------- */
  .section-{{ section.id }}-wrap .collection__title {
    display: grid;
    gap: 8px;
    margin-bottom: clamp(12px, 2vw, 16px);
  }
  .section-{{ section.id }}-wrap .collection__title .title {
    letter-spacing: -0.02em;
    font-weight: var(--title-weight);
    line-height: 1.1;
  }
  .section-{{ section.id }}-wrap .collection__description {
    opacity: .85;
    max-width: 70ch;
  }

  /* ---------- Grid ---------- */
  .section-{{ section.id }}-wrap .product-grid {
    gap: var(--gap);
  }

  /* ---------- Card ---------- */
  .section-{{ section.id }}-wrap .contains-card--product .card {
    border-radius: var(--card-radius);
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    box-shadow: var(--card-shadow);
    overflow: clip;
    transition: transform .28s ease, box-shadow .28s ease, border-color .28s ease;
    backdrop-filter: saturate(1.2) blur(6px);
  }
  .section-{{ section.id }}-wrap .contains-card--product .card:hover,
  .section-{{ section.id }}-wrap .contains-card--product .card:focus-within {
    transform: translateY(-3px);
    box-shadow: var(--elev);
    border-color: color-mix(in oklab, var(--color-foreground, #000) 18%, transparent);
  }

  /* Bild-Zoom */
  .section-{{ section.id }}-wrap .card__media img,
  .section-{{ section.id }}-wrap .card__inner img {
    transform: scale(1);
    transition: transform .5s ease;
  }
  .section-{{ section.id }}-wrap .card:hover .card__media img,
  .section-{{ section.id }}-wrap .card:hover .card__inner img {
    transform: scale(1.04);
  }

  /* Preis/Buttons */
  .section-{{ section.id }}-wrap .price { font-weight: 700; letter-spacing: -0.01em; }
  .section-{{ section.id }}-wrap .button,
  .section-{{ section.id }}-wrap .button--secondary {
    border-radius: 999px; padding-inline: 18px; min-height: 44px;
    box-shadow: 0 1px 1px rgb(0 0 0 / 0.05);
    transition: transform .18s ease, box-shadow .18s ease;
  }
  .section-{{ section.id }}-wrap .button:hover { transform: translateY(-1px); box-shadow: 0 8px 20px rgb(0 0 0 / 0.08); }

  /* Slider Buttons */
  .section-{{ section.id }}-wrap .slider-buttons { gap: 12px; align-items: center; }
  .section-{{ section.id }}-wrap .slider-button {
    border-radius: 999px;
    background: color-mix(in oklab, var(--card-bg) 68%, transparent);
    border: 1px solid var(--card-border);
    box-shadow: var(--card-shadow);
    width: 44px; height: 44px;
    transition: transform .18s ease, background .2s ease, border-color .2s ease;
    backdrop-filter: saturate(1.1) blur(6px);
  }
  .section-{{ section.id }}-wrap .slider-button:hover {
    transform: translateY(-1px);
    border-color: color-mix(in oklab, var(--color-foreground, #000) 20%, transparent);
  }
  .section-{{ section.id }}-wrap .slider-counter { font-weight: 600; opacity: .85; }

  /* View-all Button */
  .section-{{ section.id }}-wrap .collection__view-all :where(.button,.button--secondary,.link) {
    border-radius: 999px; padding-inline: 20px; min-height: 46px;
  }

  /* Focus */
  .section-{{ section.id }}-wrap :where(a,button,[role="button"]):focus-visible {
    outline: none; box-shadow: var(--ring-strong); border-radius: 12px;
  }

  /* FIX: Immer 4 Spalten auf Desktop + Slider-Breite */
  @media (min-width: 990px) {
    #collection-{{ section.id }} .product-grid.grid--4-col-desktop {
      grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
    }
    #collection-{{ section.id }} .product-grid.grid--4-col-desktop > .grid__item {
      width: auto !important; min-width: 0 !important; flex: 0 0 auto !important;
    }
    #collection-{{ section.id }} .slider--desktop .grid__item.slider__slide {
      flex: 0 0 25% !important; max-width: 25% !important;
    }
  }

  /* Motion safe */
  @media (prefers-reduced-motion: reduce) {
    .section-{{ section.id }}-wrap * { transition: none !important; animation: none !important; }
  }
  /* === HARD OVERRIDE: UL-ID erzwingt 4 Spalten auf Desktop === */
@media (min-width: 990px) {
  /* 1) Grid direkt auf dem UL (eindeutige ID) */
  #collection-{{ section.id }} #Slider-{{ section.id }} {
    display: grid !important;
    grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
    grid-auto-flow: row !important;
    gap: var(--gap) !important;
  }

  /* 2) Alle Kinder-<li> neutralisieren (kein min-/max-width, kein Flex) */
  #collection-{{ section.id }} #Slider-{{ section.id }} > li {
    width: auto !important;
    min-width: 0 !important;
    max-width: none !important;
    flex: initial !important;
  }

  /* 3) Falls Slider-Klassen aktiv sind, heb deren Breiten auf */
  #collection-{{ section.id }} .slider--desktop #Slider-{{ section.id }} > li,
  #collection-{{ section.id }} #Slider-{{ section.id }} > li.slider__slide {
    flex: initial !important;
    max-width: none !important;
  }
}
/* — Hintergrund wie die Website: rein weiß — */
.section-{{ section.id }}-wrap { 
  background: #fff !important;   /* setzt den Section-Background auf Weiß */
  --card-bg: #fff;                /* Karten bekommen ebenfalls Weiß (ohne Transparenz) */
}
/* Versand-Info: unter Titel, über Preis (nur in dieser Section) */
.section-{{ section.id }}-wrap .price::before,
.section-{{ section.id }}-wrap .card-information .price::before {
  content: "Lieferung 1–3 Werktage · Kostenloser Versand";
  display: block;
  color: #10b981;           /* grün */
  font-weight: 700;
  font-size: 12px;
  line-height: 1.35;
  margin-bottom: 4px;       /* Abstand zum Preis */
  letter-spacing: .01em;
}

/* etwas Feintuning, falls nötig */
.section-{{ section.id }}-wrap .price {
  margin-top: 2px;
}

{%- endstyle -%}

{%- liquid
  assign products_to_display = section.settings.collection.all_products_count
  if section.settings.collection.all_products_count > section.settings.products_to_show
    assign products_to_display = section.settings.products_to_show
    assign more_in_collection = true
  endif

  assign columns_mobile_int = section.settings.columns_mobile | plus: 0
  assign columns_desktop_int = section.settings.columns_desktop | plus: 0
  assign show_mobile_slider = false
  if section.settings.swipe_on_mobile and products_to_display > columns_mobile_int
    assign show_mobile_slider = true
  endif

  assign max_columns_to_show = columns_mobile_int
  if columns_desktop_int > columns_mobile_int
    assign max_columns_to_show = columns_desktop_int
  endif

  assign show_desktop_slider = false
  if section.settings.enable_desktop_slider and products_to_display > section.settings.columns_desktop
    assign show_desktop_slider = true
  endif
-%}

<div class="color-{{ section.settings.color_scheme }} isolate section-{{ section.id }}-wrap">
  <div
    class="collection{% if section.settings.quick_add == 'bulk' %} collection-quick-add-bulk{% endif %} section-{{ section.id }}-padding{% if section.settings.full_width %} collection--full-width{% endif %}"
    id="collection-{{ section.id }}"
    data-id="{{ section.id }}"
  >
    <div class="collection__title title-wrapper title-wrapper--no-top-margin{% unless section.settings.full_width %} page-width{% endunless %}{% if show_mobile_slider %} title-wrapper--self-padded-tablet-down{% endif %}{% if show_desktop_slider %} collection__title--desktop-slider{% endif %}">
      {%- if section.settings.title != blank -%}
        <h2 class="title inline-richtext {{ section.settings.heading_size }}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
          {{ section.settings.title }}
        </h2>
      {%- endif -%}
      {%- if section.settings.description != blank or section.settings.show_description and section.settings.collection.description != empty -%}
        <div class="collection__description {{ section.settings.description_style }} rte{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
          {%- if section.settings.show_description -%}
            {{ section.settings.collection.description }}
          {%- else -%}
            {{ section.settings.description -}}
          {%- endif %}
        </div>
      {%- endif -%}
    </div>

    <!-- page-width nur, wenn NICHT Full width -->
    <slider-component class="slider-mobile-gutter{% if section.settings.full_width %} slider-component-full-width{% endif %}{% if show_mobile_slider == false and section.settings.full_width == false %} page-width{% endif %}{% if show_desktop_slider == false and section.settings.full_width == false %} page-width-desktop{% endif %}{% if show_desktop_slider %} slider-component-desktop{% endif %}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
      <ul
        id="Slider-{{ section.id }}"
        data-id="{{ section.id }}"
        class="grid product-grid contains-card contains-card--product{% if settings.card_style == 'standard' %} contains-card--standard{% endif %} grid--{{ section.settings.columns_desktop }}-col-desktop{% if section.settings.collection == blank %} grid--2-col-tablet-down{% else %} grid--{{ section.settings.columns_mobile }}-col-tablet-down{% endif %}{% if show_mobile_slider or show_desktop_slider %} slider{% if show_desktop_slider %} slider--desktop{% endif %}{% if show_mobile_slider %} slider--tablet grid--peek{% endif %}{% endif %}"
        role="list"
        aria-label="{{ 'general.slider.name' | t }}"
      >
        {% assign skip_card_product_styles = false %}

        {%- if section.settings.collection.products.size > 0 -%}
          {% assign lazy_load = false %}
          {% paginate section.settings.collection.products by section.settings.products_to_show %}
            {%- for product in section.settings.collection.products limit: section.settings.products_to_show -%}
              {% if lazy_load == false and forloop.index > max_columns_to_show %}
                {% assign lazy_load = true %}
              {% endif %}
              <li
                id="Slide-{{ section.id }}-{{ forloop.index }}"
                class="grid__item{% if show_mobile_slider or show_desktop_slider %} slider__slide{% endif %}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                {% if settings.animations_reveal_on_scroll %}
                  data-cascade
                  style="--animation-order: {{ forloop.index }};"
                {% endif %}
              >
                {% render 'card-product',
                  card_product: product,
                  media_aspect_ratio: section.settings.image_ratio,
                  image_shape: section.settings.image_shape,
                  lazy_load: lazy_load,
                  show_secondary_image: section.settings.show_secondary_image,
                  show_vendor: section.settings.show_vendor,
                  show_rating: section.settings.show_rating,
                  skip_styles: skip_card_product_styles,
                  section_id: section.id,
                  quick_add: section.settings.quick_add
                %}
              </li>
              {%- assign skip_card_product_styles = true -%}
            {%- endfor -%}
          {% endpaginate %}
        {%- else -%}
          {%- for i in (1..section.settings.columns_desktop) -%}
            <li
              class="grid__item{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
              {% if settings.animations_reveal_on_scroll %}
                data-cascade
                style="--animation-order: {{ forloop.index }};"
              {% endif %}
            >
              {% liquid
                assign ridx = forloop.rindex
                case ridx
                  when 5
                    assign ridx = 1
                  when 6
                    assign ridx = 2
                endcase
              %}
              {%- assign placeholder_image = 'product-apparel-' | append: ridx -%}
              {% render 'card-product',
                show_vendor: section.settings.show_vendor,
                media_aspect_ratio: section.settings.image_ratio,
                image_shape: section.settings.image_shape,
                lazy_load: false,
                placeholder_image: placeholder_image
              %}
            </li>
          {%- endfor -%}
        {%- endif -%}
      </ul>

      {%- if show_mobile_slider or show_desktop_slider -%}
        <div class="slider-buttons">
          <button
            type="button"
            class="slider-button slider-button--prev"
            name="previous"
            aria-label="{{ 'general.slider.previous_slide' | t }}"
            aria-controls="Slider-{{ section.id }}"
          >
            <span class="svg-wrapper">
              {{- 'icon-caret.svg' | inline_asset_content -}}
            </span>
          </button>
          <div class="slider-counter caption">
            <span class="slider-counter--current">1</span>
            <span aria-hidden="true"> / </span>
            <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
            <span class="slider-counter--total">{{ products_to_display }}</span>
          </div>
          <button
            type="button"
            class="slider-button slider-button--next"
            name="next"
            aria-label="{{ 'general.slider.next_slide' | t }}"
            aria-controls="Slider-{{ section.id }}"
          >
            <span class="svg-wrapper">
              {{- 'icon-caret.svg' | inline_asset_content -}}
            </span>
          </button>
        </div>
      {%- endif -%}
    </slider-component>

    {%- if section.settings.show_view_all and more_in_collection -%}
      <div class="center collection__view-all{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
        <a
          href="{{ section.settings.collection.url }}"
          class="{% if section.settings.view_all_style == 'link' %}link underlined-link{% elsif section.settings.view_all_style == 'solid' %}button{% else %}button button--secondary{% endif %}"
          aria-label="{{ 'sections.featured_collection.view_all_label' | t: collection_name: section.settings.collection.title | escape }}"
        >
          {{ 'sections.featured_collection.view_all' | t }}
        </a>
      </div>
    {%- endif -%}

    {% if section.settings.image_shape == 'arch' %}
      {{ 'mask-arch.svg' | inline_asset_content }}
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "t:sections.featured-collection.name",
  "tag": "section",
  "class": "section",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    { "type": "collection", "id": "collection", "label": "t:sections.featured-collection.settings.collection.label" },
    { "type": "range", "id": "products_to_show", "min": 2, "max": 25, "step": 1, "default": 4, "label": "t:sections.featured-collection.settings.products_to_show.label" },

    { "type": "header", "content": "t:sections.featured-collection.settings.header_text.content" },
    { "type": "inline_richtext", "id": "title", "default": "t:sections.featured-collection.settings.title.default", "label": "t:sections.featured-collection.settings.title.label" },
    { "type": "select", "id": "heading_size",
      "options": [
        { "value": "h2", "label": "t:sections.all.heading_size.options__1.label" },
        { "value": "h1", "label": "t:sections.all.heading_size.options__2.label" },
        { "value": "h0", "label": "t:sections.all.heading_size.options__3.label" },
        { "value": "hxl", "label": "t:sections.all.heading_size.options__4.label" },
        { "value": "hxxl", "label": "t:sections.all.heading_size.options__5.label" }
      ],
      "default": "h1", "label": "t:sections.all.heading_size.label"
    },
    { "type": "richtext", "id": "description", "label": "t:sections.featured-collection.settings.description.label" },
    { "type": "checkbox", "id": "show_description", "label": "t:sections.featured-collection.settings.show_description.label", "default": false },
    { "type": "select", "id": "description_style", "label": "t:sections.featured-collection.settings.description_style.label",
      "options": [
        { "value": "body", "label": "t:sections.featured-collection.settings.description_style.options__1.label" },
        { "value": "subtitle", "label": "t:sections.featured-collection.settings.description_style.options__2.label" },
        { "value": "uppercase", "label": "t:sections.featured-collection.settings.description_style.options__3.label" }
      ],
      "default": "body"
    },

    { "type": "header", "content": "t:sections.featured-collection.settings.header_collection.content" },
    { "type": "range", "id": "columns_desktop", "min": 1, "max": 6, "step": 1, "default": 4, "label": "t:sections.featured-collection.settings.columns_desktop.label" },
    { "type": "checkbox", "id": "enable_desktop_slider", "label": "t:sections.featured-collection.settings.enable_desktop_slider.label", "default": false },
    { "type": "checkbox", "id": "full_width", "label": "t:sections.featured-collection.settings.full_width.label", "default": false },
    { "type": "checkbox", "id": "show_view_all", "default": true, "label": "t:sections.featured-collection.settings.show_view_all.label", "info": "t:sections.featured-collection.settings.show_view_all.info" },
    { "type": "select", "id": "view_all_style", "label": "t:sections.featured-collection.settings.view_all_style.label",
      "options": [
        { "value": "link", "label": "t:sections.featured-collection.settings.view_all_style.options__1.label" },
        { "value": "outline", "label": "t:sections.featured-collection.settings.view_all_style.options__2.label" },
        { "value": "solid", "label": "t:sections.featured-collection.settings.view_all_style.options__3.label" }
      ],
      "default": "solid"
    },
    { "type": "color_scheme", "id": "color_scheme", "label": "t:sections.all.colors.label", "info": "t:sections.all.colors.has_cards_info", "default": "scheme-1" },

    { "type": "header", "content": "t:sections.featured-collection.settings.header.content" },
    { "type": "select", "id": "image_ratio",
      "options": [
        { "value": "adapt", "label": "t:sections.featured-collection.settings.image_ratio.options__1.label" },
        { "value": "portrait", "label": "t:sections.featured-collection.settings.image_ratio.options__2.label" },
        { "value": "square", "label": "t:sections.featured-collection.settings.image_ratio.options__3.label" }
      ],
      "default": "adapt", "label": "t:sections.featured-collection.settings.image_ratio.label"
    },
    { "type": "select", "id": "image_shape",
      "options": [
        { "value": "default", "label": "t:sections.all.image_shape.options__1.label" },
        { "value": "arch", "label": "t:sections.all.image_shape.options__2.label" },
        { "value": "blob", "label": "t:sections.all.image_shape.options__3.label" },
        { "value": "chevronleft", "label": "t:sections.all.image_shape.options__4.label" },
        { "value": "chevronright", "label": "t:sections.all.image_shape.options__5.label" },
        { "value": "diamond", "label": "t:sections.all.image_shape.options__6.label" },
        { "value": "parallelogram", "label": "t:sections.all.image_shape.options__7.label" },
        { "value": "round", "label": "t:sections.all.image_shape.options__8.label" }
      ],
      "default": "default", "label": "t:sections.all.image_shape.label"
    },
    { "type": "checkbox", "id": "show_secondary_image", "default": false, "label": "t:sections.featured-collection.settings.show_secondary_image.label" },
    { "type": "checkbox", "id": "show_vendor", "default": false, "label": "t:sections.featured-collection.settings.show_vendor.label" },
    { "type": "checkbox", "id": "show_rating", "default": false, "label": "t:sections.featured-collection.settings.show_rating.label", "info": "t:sections.featured-collection.settings.show_rating.info" },
    { "type": "select", "id": "quick_add", "default": "none", "label": "t:sections.main-collection-product-grid.settings.quick_add.label",
      "options": [
        { "value": "none", "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_1" },
        { "value": "standard", "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_2" },
        { "value": "bulk", "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_3" }
      ]
    },

    { "type": "header", "content": "t:sections.featured-collection.settings.header_mobile.content" },
    { "type": "select", "id": "columns_mobile", "default": "2", "label": "t:sections.featured-collection.settings.columns_mobile.label",
      "options": [
        { "value": "1", "label": "t:sections.featured-collection.settings.columns_mobile.options__1.label" },
        { "value": "2", "label": "t:sections.featured-collection.settings.columns_mobile.options__2.label" }
      ]
    },
    { "type": "checkbox", "id": "swipe_on_mobile", "default": false, "label": "t:sections.featured-collection.settings.swipe_on_mobile.label" },

    { "type": "header", "content": "t:sections.all.padding.section_padding_heading" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "t:sections.all.padding.padding_top", "default": 36 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "t:sections.all.padding.padding_bottom", "default": 36 }
  ],
  "presets": [
    { "name": "t:sections.featured-collection.presets.name" }
  ]
}
{% endschema %}
